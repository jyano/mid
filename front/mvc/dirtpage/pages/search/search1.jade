<?php


//include('resources/init.php');


$topic_searched = strtolower( $_GET['topic'] )




html
    head
        meta(http-equiv="Content-Type", content="text/html, charset=UTF-8")
        title dirtpage: $topic_searched


 
    body(onLoad="document.form1.topic.focus()")



<div id="everything">
 
<?php 
include("header.php");
?>

<br><br>

<div id="holder"><br>

<span class = "redtitle">results: <?php echo "\"$topic_searched\""; echo "</span>"; ?>





<br><br>


<?php


//THIS IS TO DISPLAY THE EXACT MATCH TOPIC IF THERE IS ONE

$query = "SELECT topic FROM topics WHERE topic like '$topic_searched'   "
$result = mysql_query($query) 
$num_results = mysql_num_rows($result)

if ($num_results > 0) {

<div class = "dirt">

<A HREF = "page/?topic=  str_replace(" ", "+", $topic_searched) >

<span class="topic">   <span class="expandable">  toLowerCase($topic_searched) </span>     </span>

</a>



$result = mysql_query(   "SELECT message FROM messages WHERE topic like '$topic_searched'"  )

$num_results2 = mysql_num_rows($result)

<A HREF="http://www.dirtpage.com/page/<?php echo str_replace(" ", "+", $row['person']); ?>"><?php

<span class="topic">

<span class="expandable">   toLowerCase( $row['topic'] ) </span>

</span>

</a>

<span class="smallgreen">   ( $num_results2 items ) </span>

 </div>

 <br>


}



//THIS IS TO SHOW 'NO MESSAGES' IF THERE IS NO EXACT TOPIC MATCH


if ($num_results < 1 ) 
 
 <span class = "smallgreen"> There is no ' toLowerCase($topic_searched) '  topic  </span>
 
 <a href = "page.php?topic=<?php echo "$topic_searched"?>">  - start this page! </a>


<?php

echo "<br><br>"}



// END OF THAT
//


// THIS IS FOR THE FIRST BATCH'NON-EXACT' TOPIC MATCHES


while($row =models.topics.find( { "$and" : [{"topic": /.*$topic_searched.*/},
{ "topic": { "$ne": "$topic_searched" } } ]}).sort('-score').limit(7).exec()
)



while($row = mysql_fetch_array($result)){
.dirt
    $t = $row['topic'];
     $query3 = "SELECT * FROM messages WHERE topic LIKE '$t'";
    $result3 = mysql_query($query3) ;
    $num_results3 = mysql_num_rows($result3);

    a(HREF="page.jade?topic=<?php echo str_replace(" ", "+", $row['topic']))
        span.topic
            span.expandable toLowerCase($row['topic'])
    span.smallgreen" ( $num_results3 items)


<br>

}
//END OF THAT
//







//THE FOLLOWING IS THE SEARCH AND RESULTS FOR 'MESSAGE' MATCHES (THAT ARE NOT ALSO TOPIC MATCHES)
?> <div id = "messagematches"> <?php

<br>


$result = mysql_query(
 "SELECT * FROM messages WHERE (message like '%$topic_searched %' or message like '% $topic_searched%' or message like '$topic_searched')  AND topic not like '%$topic_searched%' limit 100";
)

$num_results2 = mysql_num_rows(

$result

)


$query = "SELECT * FROM messages WHERE (message like '%$topic_searched %' or message like '% $topic_searched%' or message like '$topic_searched')  AND topic not like '%$topic_searched%'

ORDER BY score DESC limit 3";

$result = mysql_query($query)






if ($num_results2 > 0 ){

echo "<span class = \"gotomessages topic2\">

<a href=\"http://www.dirtpage.com/search_messages.php?topic_searched=". $topic_searched ."\">See all message matches</a> (" . $num_results2." total)

</span> <span class = \"hidemessages\"></span><br><br>"



	while($row = mysql_fetch_array($result)){

	?>

	<A HREF="page/?topic=   <?php echo str_replace(" ", "+", $row['topic']) ?> ">

	<? php echo "<span class = \"smalltopic\"><span class = \"card\">" . strtolower($row['topic']) . "</span> : " . "</span></a>" .

	"<span class = \"message\">" .  hyper($row['message']). "</span>"

	echo "<br><br>"
	}



	}














	echo "<br></div>";



//THE FOLLOWING IS THE SEARCH AND RESULTS FOR 'PICTURE' MATCHES (THAT ARE NOT ALSO TOPIC MATCHES)
?> <div id = "messagematches"> <?php
echo "<br>";

$query = "SELECT * FROM captions WHERE (caption like '%$topic_searched %' or caption like '% $topic_searched%' or caption like '$topic_searched')  AND picture not like '%$topic_searched%'"; 
$result = mysql_query($query) ;
$num_results2 = mysql_num_rows($result);

$query = "SELECT * FROM captions WHERE (caption like '%$topic_searched %' or caption like '% $topic_searched%' or caption like '$topic_searched')  AND picture not like '%$topic_searched%'
ORDER BY score DESC limit 1"; 
$result = mysql_query($query) ;


 
if ($num_results2 > 0 ){echo "<span class = \"gotomessages topic2\"><a href=\"http://www.dirtpage.com/search_pictures.php?topic_searched=". $topic_searched ."\">See all picture matches</a> (". $num_results2 ." total) </span> <span class = \"hidemessages\"></span><br><br>";
	while($row = mysql_fetch_array($result)){	
	
$p = $row['picture']



$result4 = mysql_query(   "all pictures WHERE pictures.picture like '$p'"   )


while($row4 = mysql_fetch_array($result4)){ $topic = $row4['topic']}


}

   
 <A HREF="http://www.dirtpage.com/page.php?topic=". str_replace(" ", "+", $topic). "\"><span class=\"smallyellow\">". $topic . "</span></a><br>"
    
    
 <a href = "http://www.dirtpage.com/page.php?topic=". $topic . "&mode=picture&picture=". $row['picture'] . "\">
 
 
 <img src="\pictures\" +  "$row['picture']"    height="150" border="black">   </a> 
 




    <br>
    
	<span class="tinysilver">  toLowerCase($row['caption'])   </span>  
	
	
	<span class = "message">  hyper($row['message']) </span>
	 
	 <br><br>
	 } }
	
	
	<br></div>


 


//
// THIS IS FOR THE SECOND BATCH OF 'NON-EXACT' TOPIC MATCHES



while($row =models.topics.find( { "$and" : [{"topic": /.*$topic_searched.*/},
{ "topic": { "$ne": "$topic_searched" } } ]}).sort('-score').skip(7).limit(50).exec()

){



$t = $row['topic']


$num_results3 =  models.messages.find({topic: /.*$t.*/})


    .dirt
        a(HREF=   "page/?topic=   str_replace(" ", "+", $row['topic']))
          span.topic
            span.expandable">"  +  toLowerCase($row['topic'])

        .smallgreen  ( $num_results3  +  total items)



    br




//END OF THAT
//
?>






</div>

<span id = "right">
<?php include $_SERVER['DOCUMENT_ROOT'] . '/divfillers/right.php';  ?>
</span>
  


</div>
</body>

  

